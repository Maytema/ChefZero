import express from 'express';
import cors from 'cors';
import path from 'path';
import { fileURLToPath } from 'url';
import { createClient } from '@supabase/supabase-js';
import 'dotenv/config';

// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è ES –º–æ–¥—É–ª–µ–π
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const app = express();
const PORT = process.env.PORT || 3000;

// Middleware
app.use(cors());
app.use(express.json());
app.use(express.static(path.join(__dirname, 'public')));

// –ö–û–†–ù–ï–í–û–ô –ü–£–¢–¨ - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Railway Healthcheck
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

// Healthcheck –¥–ª—è Railway
app.get('/health', (req, res) => {
    res.status(200).json({ 
        status: 'healthy', 
        service: 'FridgeChefs',
        timestamp: new Date().toISOString()
    });
});

// ========== –ë–ê–ó–ê –î–ê–ù–ù–´–• ==========
const INGREDIENTS_DB = [
    // –û–í–û–©–ò
    { id: 1, name: "—è–π—Ü–∞", icon: "ü•ö", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 2, name: "–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", icon: "ü•î", category: "–æ–≤–æ—â–∏" },
    { id: 3, name: "–ø–æ–º–∏–¥–æ—Ä—ã", icon: "üçÖ", category: "–æ–≤–æ—â–∏" },
    { id: 4, name: "–ª—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", icon: "üßÖ", category: "–æ–≤–æ—â–∏" },
    { id: 5, name: "–º–æ—Ä–∫–æ–≤—å", icon: "ü•ï", category: "–æ–≤–æ—â–∏" },
    { id: 6, name: "–æ–≥—É—Ä—Ü—ã", icon: "ü•í", category: "–æ–≤–æ—â–∏" },
    { id: 7, name: "–∫–∞–ø—É—Å—Ç–∞", icon: "ü•¨", category: "–æ–≤–æ—â–∏" },
    { id: 8, name: "–±—Ä–æ–∫–∫–æ–ª–∏", icon: "ü•¶", category: "–æ–≤–æ—â–∏" },
    { id: 9, name: "–∫–∞–±–∞—á–∫–∏", icon: "ü•í", category: "–æ–≤–æ—â–∏" },
    { id: 10, name: "–±–∞–∫–ª–∞–∂–∞–Ω—ã", icon: "üçÜ", category: "–æ–≤–æ—â–∏" },
    { id: 11, name: "–ø–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π", icon: "ü´ë", category: "–æ–≤–æ—â–∏" },
    { id: 12, name: "—á–µ—Å–Ω–æ–∫", icon: "üßÑ", category: "–æ–≤–æ—â–∏" },
    { id: 13, name: "—Ä–µ–¥–∏—Å", icon: "üå∂Ô∏è", category: "–æ–≤–æ—â–∏" },
    { id: 14, name: "—Å–≤–µ–∫–ª–∞", icon: "üç†", category: "–æ–≤–æ—â–∏" },
    { id: 15, name: "—Ç—ã–∫–≤–∞", icon: "üéÉ", category: "–æ–≤–æ—â–∏" },
    { id: 16, name: "–ø–µ—Ç—Ä—É—à–∫–∞", icon: "üåø", category: "–∑–µ–ª–µ–Ω—å" },
    { id: 17, name: "—É–∫—Ä–æ–ø", icon: "üå±", category: "–∑–µ–ª–µ–Ω—å" },
    { id: 18, name: "–±–∞–∑–∏–ª–∏–∫", icon: "üåø", category: "–∑–µ–ª–µ–Ω—å" },
    { id: 19, name: "—à–ø–∏–Ω–∞—Ç", icon: "ü•¨", category: "–∑–µ–ª–µ–Ω—å" },
    { id: 20, name: "—Å–∞–ª–∞—Ç", icon: "ü•¨", category: "–∑–µ–ª–µ–Ω—å" },
    { id: 21, name: "–∫—É–∫—É—Ä—É–∑–∞", icon: "üåΩ", category: "–æ–≤–æ—â–∏" },
    { id: 22, name: "–≥–æ—Ä–æ—Ö", icon: "ü´õ", category: "–æ–≤–æ—â–∏" },
    { id: 23, name: "—Ñ–∞—Å–æ–ª—å", icon: "ü´õ", category: "–æ–≤–æ—â–∏" },
    { id: 24, name: "–∏–º–±–∏—Ä—å", icon: "üåø", category: "–æ–≤–æ—â–∏" },
    { id: 25, name: "–ø–µ—Ä–µ—Ü —á–∏–ª–∏", icon: "üå∂Ô∏è", category: "–æ–≤–æ—â–∏" },

    // –§–†–£–ö–¢–´
    { id: 26, name: "—è–±–ª–æ–∫–∏", icon: "üçé", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 27, name: "–±–∞–Ω–∞–Ω—ã", icon: "üçå", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 28, name: "–∞–ø–µ–ª—å—Å–∏–Ω—ã", icon: "üçä", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 29, name: "–º–∞–Ω–¥–∞—Ä–∏–Ω—ã", icon: "üçä", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 30, name: "–ª–∏–º–æ–Ω—ã", icon: "üçã", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 31, name: "–≥—Ä—É—à–∏", icon: "üçê", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 32, name: "–ø–µ—Ä—Å–∏–∫–∏", icon: "üçë", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 33, name: "–≤–∏–Ω–æ–≥—Ä–∞–¥", icon: "üçá", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 34, name: "–∫–∏–≤–∏", icon: "ü•ù", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 35, name: "–∞–Ω–∞–Ω–∞—Å", icon: "üçç", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 36, name: "–∫–ª—É–±–Ω–∏–∫–∞", icon: "üçì", category: "—è–≥–æ–¥—ã" },
    { id: 37, name: "–º–∞–ª–∏–Ω–∞", icon: "üçì", category: "—è–≥–æ–¥—ã" },
    { id: 38, name: "—á–µ—Ä–Ω–∏–∫–∞", icon: "ü´ê", category: "—è–≥–æ–¥—ã" },
    { id: 39, name: "–≤–∏—à–Ω—è", icon: "üçí", category: "—è–≥–æ–¥—ã" },
    { id: 40, name: "–∞—Ä–±—É–∑", icon: "üçâ", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 41, name: "–¥—ã–Ω—è", icon: "üçà", category: "—Ñ—Ä—É–∫—Ç—ã" },

    // –ú–Ø–°–û
    { id: 42, name: "–∫—É—Ä–∏—Ü–∞", icon: "üçó", category: "–º—è—Å–æ" },
    { id: 43, name: "–≥–æ–≤—è–¥–∏–Ω–∞", icon: "ü•©", category: "–º—è—Å–æ" },
    { id: 44, name: "—Å–≤–∏–Ω–∏–Ω–∞", icon: "üê∑", category: "–º—è—Å–æ" },
    { id: 45, name: "–∏–Ω–¥–µ–π–∫–∞", icon: "ü¶É", category: "–º—è—Å–æ" },
    { id: 46, name: "—É—Ç–∫–∞", icon: "ü¶Ü", category: "–º—è—Å–æ" },
    { id: 47, name: "–±–∞—Ä–∞–Ω–∏–Ω–∞", icon: "üêë", category: "–º—è—Å–æ" },
    { id: 48, name: "–∫—Ä–æ–ª–∏–∫", icon: "üêá", category: "–º—è—Å–æ" },
    { id: 49, name: "–±–µ–∫–æ–Ω", icon: "ü•ì", category: "–º—è—Å–æ" },
    { id: 50, name: "–≤–µ—Ç—á–∏–Ω–∞", icon: "üçñ", category: "–º—è—Å–æ" },

    // –†–´–ë–ê
    { id: 51, name: "–ª–æ—Å–æ—Å—å", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 52, name: "—Å–µ–º–≥–∞", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 53, name: "—Ç—É–Ω–µ—Ü", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 54, name: "—Å–µ–ª—å–¥—å", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 55, name: "—Ç—Ä–µ—Å–∫–∞", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 56, name: "–º–∏–Ω—Ç–∞–π", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 57, name: "–∫—Ä–µ–≤–µ—Ç–∫–∏", icon: "ü¶ê", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 58, name: "–∫–∞–ª—å–º–∞—Ä—ã", icon: "ü¶ë", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 59, name: "–º–∏–¥–∏–∏", icon: "ü¶™", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },

    // –ú–û–õ–û–ß–ù–´–ï
    { id: 60, name: "–º–æ–ª–æ–∫–æ", icon: "ü•õ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 61, name: "–∫–µ—Ñ–∏—Ä", icon: "ü•õ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 62, name: "–π–æ–≥—É—Ä—Ç", icon: "ü•Ñ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 63, name: "—Å–º–µ—Ç–∞–Ω–∞", icon: "ü•£", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 64, name: "—Ç–≤–æ—Ä–æ–≥", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 65, name: "—Å—ã—Ä", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 66, name: "—Å–ª–∏–≤–∫–∏", icon: "üç∂", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 67, name: "–º–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ", icon: "üßà", category: "–º–æ–ª–æ—á–Ω—ã–µ" },

    // –ö–†–£–ü–´ –ò –ú–£–ö–ê
    { id: 68, name: "—Ä–∏—Å", icon: "üçö", category: "–∫—Ä—É–ø—ã" },
    { id: 69, name: "–≥—Ä–µ—á–∫–∞", icon: "üåæ", category: "–∫—Ä—É–ø—ã" },
    { id: 70, name: "–æ–≤—Å—è–Ω–∫–∞", icon: "ü•£", category: "–∫—Ä—É–ø—ã" },
    { id: 71, name: "–º–∞–∫–∞—Ä–æ–Ω—ã", icon: "üçù", category: "–∫—Ä—É–ø—ã" },
    { id: 72, name: "–º—É–∫–∞", icon: "üåæ", category: "–º—É–∫–∞" },
    { id: 73, name: "—Ö–ª–µ–±", icon: "üçû", category: "—Ö–ª–µ–±" },
    { id: 74, name: "–ª–∞–≤–∞—à", icon: "ü´ì", category: "—Ö–ª–µ–±" },

    // –°–ü–ï–¶–ò–ò –ò –ü–†–û–ß–ï–ï
    { id: 75, name: "—Å–æ–ª—å", icon: "üßÇ", category: "—Å–ø–µ—Ü–∏–∏" },
    { id: 76, name: "–ø–µ—Ä–µ—Ü", icon: "üå∂Ô∏è", category: "—Å–ø–µ—Ü–∏–∏" },
    { id: 77, name: "—Å–∞—Ö–∞—Ä", icon: "üç¨", category: "–±–∞–∫–∞–ª–µ—è" },
    { id: 78, name: "–º–µ–¥", icon: "üçØ", category: "–±–∞–∫–∞–ª–µ—è" },
    { id: 79, name: "–º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ", icon: "ü´í", category: "–º–∞—Å–ª–∞" },
    { id: 80, name: "—É–∫—Å—É—Å", icon: "üç∂", category: "–±–∞–∫–∞–ª–µ—è" },
    { id: 81, name: "–º–∞–π–æ–Ω–µ–∑", icon: "ü•£", category: "—Å–æ—É—Å—ã" },
    { id: 82, name: "–∫–µ—Ç—á—É–ø", icon: "üçÖ", category: "—Å–æ—É—Å—ã" },
    { id: 83, name: "–≥–æ—Ä—á–∏—Ü–∞", icon: "üå≠", category: "—Å–æ—É—Å—ã" },
    { id: 84, name: "—Å–æ—É—Å —Å–æ–µ–≤—ã–π", icon: "üç∂", category: "—Å–æ—É—Å—ã" },
    
    // –ï–©–ï –ü–†–û–î–£–ö–¢–´ –î–û 150
    { id: 85, name: "—Ñ–∏–Ω–∏–∫–∏", icon: "üçà", category: "—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã" },
    { id: 86, name: "–∫—É—Ä–∞–≥–∞", icon: "üçë", category: "—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã" },
    { id: 87, name: "—á–µ—Ä–Ω–æ—Å–ª–∏–≤", icon: "üçë", category: "—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã" },
    { id: 88, name: "–∏–∑—é–º", icon: "üçá", category: "—Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã" },
    { id: 89, name: "–æ—Ä–µ—Ö–∏ –≥—Ä–µ—Ü–∫–∏–µ", icon: "üå∞", category: "–æ—Ä–µ—Ö–∏" },
    { id: 90, name: "–º–∏–Ω–¥–∞–ª—å", icon: "üå∞", category: "–æ—Ä–µ—Ö–∏" },
    { id: 91, name: "–∞—Ä–∞—Ö–∏—Å", icon: "ü•ú", category: "–æ—Ä–µ—Ö–∏" },
    { id: 92, name: "—Å–µ–º–µ—á–∫–∏ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω—ã–µ", icon: "üåª", category: "—Å–µ–º–µ—á–∫–∏" },
    { id: 93, name: "–∫—É–Ω–∂—É—Ç", icon: "üå±", category: "—Å–µ–º–µ—á–∫–∏" },
    { id: 94, name: "–∞–≤–æ–∫–∞–¥–æ", icon: "ü•ë", category: "–æ–≤–æ—â–∏" },
    { id: 95, name: "–æ–ª–∏–≤–∫–∏", icon: "ü´í", category: "–æ–≤–æ—â–∏" },
    { id: 96, name: "–≥—Ä–∏–±—ã", icon: "üçÑ", category: "–≥—Ä–∏–±—ã" },
    { id: 97, name: "—Ü—É–∫–∏–Ω–∏", icon: "ü•í", category: "–æ–≤–æ—â–∏" },
    { id: 98, name: "–∞—Ä—Ç–∏—à–æ–∫", icon: "üåµ", category: "–æ–≤–æ—â–∏" },
    { id: 99, name: "—Å–ø–∞—Ä–∂–∞", icon: "üå±", category: "–æ–≤–æ—â–∏" },
    { id: 100, name: "–ø–∞–ø–∞–π—è", icon: "üçà", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 101, name: "–º–∞–Ω–≥–æ", icon: "ü•≠", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 102, name: "–≥—Ä–∞–Ω–∞—Ç", icon: "üçà", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 103, name: "–º–∞—Ä–∞–∫—É–π—è", icon: "ü•ù", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 104, name: "–∏–Ω–∂–∏—Ä", icon: "üçà", category: "—Ñ—Ä—É–∫—Ç—ã" },
    { id: 105, name: "–∫—Ä—ã–∂–æ–≤–Ω–∏–∫", icon: "üçá", category: "—è–≥–æ–¥—ã" },
    { id: 106, name: "—Å–º–æ—Ä–æ–¥–∏–Ω–∞", icon: "üçá", category: "—è–≥–æ–¥—ã" },
    { id: 107, name: "–≥–æ–ª—É–±–∏–∫–∞", icon: "ü´ê", category: "—è–≥–æ–¥—ã" },
    { id: 108, name: "–∫–ª—é–∫–≤–∞", icon: "ü´ê", category: "—è–≥–æ–¥—ã" },
    { id: 109, name: "–æ–±–ª–µ–ø–∏—Ö–∞", icon: "ü´ê", category: "—è–≥–æ–¥—ã" },
    { id: 110, name: "—Ä—è–∂–µ–Ω–∫–∞", icon: "ü•õ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 111, name: "–∞–π—Ä–∞–Ω", icon: "ü•õ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 112, name: "—Ç–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 113, name: "–±—Ä—ã–Ω–∑–∞", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 114, name: "—Å—É–ª—É–≥—É–Ω–∏", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 115, name: "–º–æ—Ü–∞—Ä–µ–ª–ª–∞", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 116, name: "–ø–∞—Ä–º–µ–∑–∞–Ω", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 117, name: "–≥–æ—Ä–≥–æ–Ω–∑–æ–ª–∞", icon: "üßÄ", category: "–º–æ–ª–æ—á–Ω—ã–µ" },
    { id: 118, name: "—è–π—Ü–∞ –ø–µ—Ä–µ–ø–µ–ª–∏–Ω—ã–µ", icon: "ü•ö", category: "—è–π—Ü–∞" },
    { id: 119, name: "–ø–µ—á–µ–Ω—å –∫—É—Ä–∏–Ω–∞—è", icon: "üçó", category: "—Å—É–±–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 120, name: "—Å–µ—Ä–¥—Ü–µ –∫—É—Ä–∏–Ω–æ–µ", icon: "‚ù§Ô∏è", category: "—Å—É–±–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 121, name: "—Ñ–∞—Ä—à –º—è—Å–Ω–æ–π", icon: "ü•©", category: "–º—è—Å–æ" },
    { id: 122, name: "–∫–æ–ª–±–∞—Å–∞", icon: "üå≠", category: "–º—è—Å–æ" },
    { id: 123, name: "—Å–æ—Å–∏—Å–∫–∏", icon: "üå≠", category: "–º—è—Å–æ" },
    { id: 124, name: "—Å–∞–ª—è–º–∏", icon: "üçñ", category: "–º—è—Å–æ" },
    { id: 125, name: "–æ–∫–æ—Ä–æ–∫", icon: "üçñ", category: "–º—è—Å–æ" },
    { id: 126, name: "–∫–æ—Ä–µ–π–∫–∞", icon: "üçñ", category: "–º—è—Å–æ" },
    { id: 127, name: "–≥—Ä—É–¥–∏–Ω–∫–∞", icon: "üçñ", category: "–º—è—Å–æ" },
    { id: 128, name: "–∫–∞—Ä–ø", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 129, name: "—â—É–∫–∞", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 130, name: "—Å—É–¥–∞–∫", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 131, name: "–æ—Å–µ—Ç—Ä", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 132, name: "—Ñ–æ—Ä–µ–ª—å —Ä–∞–¥—É–∂–Ω–∞—è", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 133, name: "—Å–∞—Ä–¥–∏–Ω—ã", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 134, name: "—Å–∫—É–º–±—Ä–∏—è", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 135, name: "–∫–∞–º–±–∞–ª–∞", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 136, name: "–ø–∞–ª—Ç—É—Å", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 137, name: "–¥–æ—Ä–∞–¥–æ", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 138, name: "—Å–∏–±–∞—Å", icon: "üêü", category: "—Ä—ã–±–∞" },
    { id: 139, name: "–æ–º–∞—Ä—ã", icon: "ü¶û", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 140, name: "–ª–∞–Ω–≥—É—Å—Ç–∏–Ω—ã", icon: "ü¶ê", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 141, name: "—É—Å—Ç—Ä–∏—Ü—ã", icon: "ü¶™", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 142, name: "–º–æ—Ä—Å–∫–∏–µ –≥—Ä–µ–±–µ—à–∫–∏", icon: "üêö", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 143, name: "–æ—Å—å–º–∏–Ω–æ–≥", icon: "üêô", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 144, name: "–∫—Ä–∞–±", icon: "ü¶Ä", category: "–º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã" },
    { id: 145, name: "–∏–∫—Ä–∞ –∫—Ä–∞—Å–Ω–∞—è", icon: "ü•´", category: "–∏–∫—Ä–∞" },
    { id: 146, name: "–∏–∫—Ä–∞ —á–µ—Ä–Ω–∞—è", icon: "ü•´", category: "–∏–∫—Ä–∞" },
    { id: 147, name: "–∏–∫—Ä–∞ –º–∏–Ω—Ç–∞—è", icon: "ü•´", category: "–∏–∫—Ä–∞" },
    { id: 148, name: "–≤–æ–¥–æ—Ä–æ—Å–ª–∏ –Ω–æ—Ä–∏", icon: "üçô", category: "–≤–æ–¥–æ—Ä–æ—Å–ª–∏" },
    { id: 149, name: "–≤–∞—Å–∞–±–∏", icon: "üçµ", category: "—Å–ø–µ—Ü–∏–∏" },
    { id: 150, name: "–∏–º–±–∏—Ä—å –º–∞—Ä–∏–Ω–æ–≤–∞–Ω–Ω—ã–π", icon: "üåø", category: "—Å–ø–µ—Ü–∏–∏" }
];

const RECIPES_DB = [
    {
        id: 1,
        name: "–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏",
        ingredients: ["—è–π—Ü–∞", "–ø–æ–º–∏–¥–æ—Ä—ã", "–ª—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", "—Å—ã—Ä"],
        time: "15 –º–∏–Ω",
        difficulty: "–ª–µ–≥–∫–æ",
        steps: [
            "1. –í–∑–±–µ–π—Ç–µ —è–π—Ü–∞ –≤ –º–∏—Å–∫–µ",
            "2. –ù–∞—Ä–µ–∂—å—Ç–µ –ø–æ–º–∏–¥–æ—Ä—ã –∏ –ª—É–∫",
            "3. –û–±–∂–∞—Ä—å—Ç–µ –ª—É–∫ 2 –º–∏–Ω—É—Ç—ã",
            "4. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–º–∏–¥–æ—Ä—ã, –∂–∞—Ä—å—Ç–µ 3 –º–∏–Ω—É—Ç—ã",
            "5. –ó–∞–ª–µ–π—Ç–µ —è–π—Ü–∞–º–∏, –≥–æ—Ç–æ–≤—å—Ç–µ 5 –º–∏–Ω—É—Ç",
            "6. –ü–æ—Å—ã–ø—å—Ç–µ —Å—ã—Ä–æ–º –ø–µ—Ä–µ–¥ –ø–æ–¥–∞—á–µ–π"
        ]
    },
    {
        id: 2,
        name: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å —Å –∫—É—Ä–∏—Ü–µ–π –≤ –¥—É—Ö–æ–≤–∫–µ",
        ingredients: ["–∫–∞—Ä—Ç–æ—Ñ–µ–ª—å", "–∫—É—Ä–∏—Ü–∞", "–ª—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", "–º–æ—Ä–∫–æ–≤—å", "—Å–º–µ—Ç–∞–Ω–∞"],
        time: "45 –º–∏–Ω",
        difficulty: "—Å—Ä–µ–¥–Ω–µ",
        steps: [
            "1. –ù–∞—Ä–µ–∂—å—Ç–µ –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –∫—É—Ä–∏—Ü—É –∏ –æ–≤–æ—â–∏",
            "2. –û–±–∂–∞—Ä—å—Ç–µ –ª—É–∫ –∏ –º–æ—Ä–∫–æ–≤—å 5 –º–∏–Ω—É—Ç",
            "3. –°–º–µ—à–∞–π—Ç–µ –≤—Å–µ —Å–æ —Å–º–µ—Ç–∞–Ω–æ–π",
            "4. –í—ã–ª–æ–∂–∏—Ç–µ –≤ —Ñ–æ—Ä–º—É –¥–ª—è –∑–∞–ø–µ–∫–∞–Ω–∏—è",
            "5. –ó–∞–ø–µ–∫–∞–π—Ç–µ 30 –º–∏–Ω—É—Ç –ø—Ä–∏ 180¬∞C"
        ]
    },
    {
        id: 3,
        name: "–°–∞–ª–∞—Ç –∏–∑ —Å–≤–µ–∂–∏—Ö –æ–≤–æ—â–µ–π",
        ingredients: ["–ø–æ–º–∏–¥–æ—Ä—ã", "–æ–≥—É—Ä—Ü—ã", "–ø–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π", "–ª—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", "–º–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ"],
        time: "10 –º–∏–Ω",
        difficulty: "–æ—á–µ–Ω—å –ª–µ–≥–∫–æ",
        steps: [
            "1. –ù–∞—Ä–µ–∂—å—Ç–µ –≤—Å–µ –æ–≤–æ—â–∏",
            "2. –°–º–µ—à–∞–π—Ç–µ –≤ —Å–∞–ª–∞—Ç–Ω–∏—Ü–µ",
            "3. –ó–∞–ø—Ä–∞–≤—å—Ç–µ –º–∞—Å–ª–æ–º –∏ —Å–æ–ª—å—é",
            "4. –ü–æ–¥–∞–≤–∞–π—Ç–µ —Å—Ä–∞–∑—É"
        ]
    },
    {
        id: 4,
        name: "–ü–∞—Å—Ç–∞ —Å —Å—ã—Ä–æ–º",
        ingredients: ["–º–∞–∫–∞—Ä–æ–Ω—ã", "—Å—ã—Ä", "—Å–ª–∏–≤–∫–∏", "—á–µ—Å–Ω–æ–∫"],
        time: "20 –º–∏–Ω",
        difficulty: "–ª–µ–≥–∫–æ",
        steps: [
            "1. –û—Ç–≤–∞—Ä–∏—Ç–µ –º–∞–∫–∞—Ä–æ–Ω—ã",
            "2. –ù–∞—Ç—Ä–∏—Ç–µ —Å—ã—Ä –Ω–∞ —Ç–µ—Ä–∫–µ",
            "3. –†–∞–∑–æ–≥—Ä–µ–π—Ç–µ —Å–ª–∏–≤–∫–∏ —Å —á–µ—Å–Ω–æ–∫–æ–º",
            "4. –°–º–µ—à–∞–π—Ç–µ –º–∞–∫–∞—Ä–æ–Ω—ã —Å —Å–æ—É—Å–æ–º",
            "5. –ü–æ—Å—ã–ø—å—Ç–µ —Å—ã—Ä–æ–º"
        ]
    },
    {
        id: 5,
        name: "–ñ–∞—Ä–µ–Ω–∞—è –∫—É—Ä–∏—Ü–∞ —Å —Ä–∏—Å–æ–º",
        ingredients: ["–∫—É—Ä–∏—Ü–∞", "—Ä–∏—Å", "–ª—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π", "–º–æ—Ä–∫–æ–≤—å"],
        time: "30 –º–∏–Ω",
        difficulty: "—Å—Ä–µ–¥–Ω–µ",
        steps: [
            "1. –û–±–∂–∞—Ä—å—Ç–µ –∫—É—Ä–∏—Ü—É –¥–æ –∑–æ–ª–æ—Ç–∏—Å—Ç–æ–π –∫–æ—Ä–æ—á–∫–∏",
            "2. –î–æ–±–∞–≤—å—Ç–µ –ª—É–∫ –∏ –º–æ—Ä–∫–æ–≤—å",
            "3. –í—Å—ã–ø—å—Ç–µ —Ä–∏—Å, –∑–∞–ª–µ–π—Ç–µ –≤–æ–¥–æ–π",
            "4. –¢—É—à–∏—Ç–µ 20 –º–∏–Ω—É—Ç –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–º –æ–≥–Ω–µ"
        ]
    }
];

// ========== API –†–û–£–¢–´ ==========

// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
app.get('/api/ingredients', (req, res) => {
    res.json({
        success: true,
        count: INGREDIENTS_DB.length,
        ingredients: INGREDIENTS_DB
    });
});

// –ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –ø–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º
app.post('/api/find-recipes', (req, res) => {
    try {
        const { ingredients = [], userId = 'default' } = req.body;
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
        const freeLeft = 3;
        const paidLeft = 10;
        
        if (freeLeft <= 0 && paidLeft <= 0) {
            return res.json({
                success: false,
                error: "–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω",
                upgrade: true,
                recipes: []
            });
        }
        
        // –ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ (–º–∏–Ω–∏–º—É–º 2 —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è)
        const matchedRecipes = RECIPES_DB.filter(recipe => {
            const matches = recipe.ingredients.filter(ing => 
                ingredients.some(userIng => 
                    userIng.toLowerCase().includes(ing.toLowerCase()) ||
                    ing.toLowerCase().includes(userIng.toLowerCase())
                )
            ).length;
            return matches >= 2;
        }).slice(0, 3);
        
        res.json({
            success: true,
            recipes: matchedRecipes,
            count: matchedRecipes.length,
            usage: {
                free_left: freeLeft - 1,
                paid_left: paidLeft,
                message: "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã: " + (freeLeft - 1) + " –æ—Å—Ç–∞–ª–æ—Å—å"
            }
        });
        
    } catch (error) {
        res.status(500).json({
            success: false,
            error: "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
        });
    }
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ò–ò —Ä–µ—Ü–µ–ø—Ç–æ–≤
app.post('/api/ai-recipes', (req, res) => {
    const { ingredients = [], preferences = '' } = req.body;
    
    const aiRecipe = {
        id: Date.now(),
        name: `–ò–ò-—Ä–µ—Ü–µ–ø—Ç: ${ingredients.slice(0, 3).join(', ')}`,
        ingredients: ingredients,
        time: "25 –º–∏–Ω",
        difficulty: "—Å—Ä–µ–¥–Ω–µ",
        steps: [
            "1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã",
            "2. –ù–∞—Ä–µ–∂—å—Ç–µ –Ω–∞ —Ä–∞–≤–Ω—ã–µ –∫—É—Å–æ—á–∫–∏",
            "3. –û–±–∂–∞—Ä—å—Ç–µ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–º –æ–≥–Ω–µ 10 –º–∏–Ω—É—Ç",
            "4. –î–æ–±–∞–≤—å—Ç–µ —Å–ø–µ—Ü–∏–∏ –ø–æ –≤–∫—É—Å—É",
            "5. –ì–æ—Ç–æ–≤—å—Ç–µ –µ—â—ë 15 –º–∏–Ω—É—Ç –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏",
            "6. –ü–æ–¥–∞–≤–∞–π—Ç–µ –≥–æ—Ä—è—á–∏–º"
        ],
        isAI: true,
        preferences: preferences
    };
    
    res.json({
        success: true,
        recipes: [aiRecipe],
        isAI: true
    });
});

// –ü–æ–∫—É–ø–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤
app.post('/api/buy-recipes', (req, res) => {
    res.json({
        success: true,
        message: "10 —Ä–µ—Ü–µ–ø—Ç–æ–≤ –∫—É–ø–ª–µ–Ω–æ –∑–∞ 99‚ÇΩ",
        usage: {
            free_left: 3,
            paid_left: 10
        }
    });
});

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
app.get('/api/usage/:userId', (req, res) => {
    res.json({
        free_left: 3,
        paid_left: 10,
        free_used: 0,
        paid_used: 0
    });
});

// ========== –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê ==========
app.listen(PORT, '0.0.0.0', () => {
    console.log(`‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É ${PORT}`);
    console.log(`üåê –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: http://localhost:${PORT}`);
    console.log(`üîß Healthcheck: http://localhost:${PORT}/health`);
    console.log(`üìä API –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤: http://localhost:${PORT}/api/ingredients`);
});
